# 项目需求与结构1. **用户登录/注册页面**
   - 菜单项："登录/注册"
   - 功能：用户邮箱注册、登录，支持 Supabase 后端认证。
   - 登录状态管理机制：
     * 多层状态存储：
       - session_state["logged_in"]：登录状态标记
       - session_state["access_token"]：访问令牌
       - session_state["user"]：用户信息
       - query_params["token"]：URL参数存储token
     * 状态检查流程：
       1. 优先检查session_state中的登录状态和token
       2. 验证token有效性（通过Supabase API）
       3. 尝试从URL参数恢复登录状态
       4. 验证失败则清除所有状态
     * 页面间状态共享：
       - 统一的auth_utils.py处理登录逻辑
       - 所有页面复用相同的状态检查机制
       - URL参数确保页面刷新不丢失登录
   - 用户交互优化：
     * 登录成功：欢迎消息 + toast通知
     * 登出操作：清除所有状态 + 页面刷新
     * 友好提示：清晰的状态反馈和引导
   - 说明：未登录自动跳转至此页面，登录后可访问其他功能。 一、项目定位
本项目为多页面 Streamlit Web 应用，具备用户登录注册、LLM（大模型）对话、秘钥管理等功能。所有功能均以菜单形式组织，每个菜单对应一个独立页面，便于后续扩展。

---

## 二、核心功能菜单

1. **用户登录/注册页面**
   - 菜单项：“登录/注册”
   - 功能：用户邮箱注册、登录，支持 Supabase 后端认证。
   - 登录状态持久化：登录成功后，用户信息和 access_token 保存在 session_state，页面刷新和切换页面时自动保持登录。
   - 自动校验与恢复：所有页面顶部统一调用登录检测和 token 校验逻辑，自动恢复登录状态，未登录自动跳转登录。
   - 自动续签：每次页面加载时自动尝试刷新 token，确保会话有效。
   - 登出功能：支持一键登出，清除 session 并刷新页面。
   - 说明：未登录时自动跳转至此页面，登录后可访问其他功能。

2. **LLM对话页面**
   - 菜单项：“智能对话”
   - 功能：与 Gemini 等兼容 OpenAI 的大模型进行多轮对话。
   - 说明：需先登录，支持模型选择（后续由秘钥管理页面提供模型列表）。

3. **LLM秘钥管理页面**
   - 菜单项：“秘钥管理”
   - 功能：填写、修改、保存 LLM API Key（如 Gemini Key），并根据秘钥自动获取可用模型列表，供用户选择。
   - 说明：支持秘钥的安全存储与更新，模型选择与对话页面联动。

---

## 三、页面与菜单结构

- 顶部或侧边栏菜单导航，点击菜单切换页面。
- 每个页面独立，互不干扰，便于后续功能扩展（如：历史记录、知识库、设置等）。

---

## 四、技术方案

- 前端框架：
  * Streamlit 多页面应用
  * `st.pages` 实现菜单导航
  * `st.session_state` 管理会话状态
  * `st.query_params` 实现页面刷新保持登录
  * `st.toast` 提供即时反馈

- 配置管理：
  * 环境变量：使用.env文件存储敏感配置
  * config模块：统一的配置加载和管理
  * 多级配置：环境变量 -> session_state -> 用户输入
  * 安全性：.env文件已加入.gitignore

- 状态管理：
  * 分层状态存储：session_state + URL参数
  * 统一的auth_utils模块
  * 登录状态自动校验和恢复
  * 完整的登录生命周期管理

- 后端服务：
  * Supabase 负责用户认证
  * Token 有效性验证
  * 数据安全存储（秘钥、偏好等）
  * 敏感配置通过环境变量管理

- LLM集成：
  * Gemini（兼容 OpenAI API）
  * API密钥安全管理（环境变量+用户输入）
  * 支持模型自动获取与切换
  * 多服务商扩展支持

---

## 五、后续扩展建议

- 新增功能均以菜单+页面形式添加，保持结构清晰。
- 可扩展：聊天历史、知识库管理、用户设置、数据分析等。
- 支持多模型、多服务商（如 OpenAI、智谱、讯飞等）。

---

## 六、开发建议

- 先实现基础三大页面（登录/注册、智能对话、秘钥管理）。
- 菜单导航与页面切换优先保证用户体验。
- 所有页面均需鉴权，未登录用户自动跳转登录页面。
- 秘钥管理页面与对话页面联动，确保模型选择与调用一致。

---

如需详细页面原型、接口设计或技术选型细节，可随时补充！
